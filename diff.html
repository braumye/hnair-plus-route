<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>èˆªç­æ•°æ®å·®å¼‚å¯¹æ¯” - HNair Plus Route</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
	<style>
		<blade keyframes|%20fadeIn%20%7B>from {
			opacity: 0;
			transform: translateY(20px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
		}

		.fade-in {
			animation: fadeIn 0.5s ease-out;
		}

		<blade keyframes|%20spin%20%7B>0% {
			transform: rotate(0deg);
		}

		100% {
			transform: rotate(360deg);
		}
		}

		.spinner {
			animation: spin 1s linear infinite;
		}
	</style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
	<div x-data="diffApp()" x-init="init()" class="container mx-auto px-4 py-8">
		<!-- å¤´éƒ¨ -->
		<header class="text-center mb-8">
			<div class="mb-4">
				<a href="index.html" class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors">
					<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
					</svg>
					è¿”å›ä¸»é¡µ
				</a>
			</div>
			<h1 class="text-4xl font-bold text-gray-800 mb-2">èˆªç­æ•°æ®å·®å¼‚å¯¹æ¯”</h1>
			<p class="text-gray-600 text-lg">å¯¹æ¯”ä¸¤ä¸ªæ—¥æœŸçš„èˆªç­æ•°æ®å˜åŒ–</p>
		</header>

		<!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
		<div class="max-w-4xl mx-auto mb-8">
			<div class="bg-white rounded-xl shadow-lg p-6">
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
					<div>
						<label class="block text-sm font-semibold text-gray-700 mb-2">é€‰æ‹©ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼š</label>
						<select x-model="file1" @change="checkCompareButton()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
							<option value="">è¯·é€‰æ‹©æ–‡ä»¶...</option>
							<template x-for="file in availableFiles" :key="file">
								<option :value="file" x-text="file"></option>
							</template>
						</select>
					</div>
					<div>
						<label class="block text-sm font-semibold text-gray-700 mb-2">é€‰æ‹©ç¬¬äºŒä¸ªæ–‡ä»¶ï¼š</label>
						<select x-model="file2" @change="checkCompareButton()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
							<option value="">è¯·é€‰æ‹©æ–‡ä»¶...</option>
							<template x-for="file in availableFiles" :key="file">
								<option :value="file" x-text="file"></option>
							</template>
						</select>
					</div>
				</div>
				<button @click="compareFiles()" :disabled="!canCompare" :class="canCompare ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-400 cursor-not-allowed'" class="w-full py-3 px-6 text-white font-semibold rounded-lg transition-colors">
					å¼€å§‹å¯¹æ¯”
				</button>
			</div>
		</div>

		<!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
		<div x-show="loading" class="max-w-4xl mx-auto mb-8">
			<div class="bg-white rounded-xl shadow-lg p-8 text-center">
				<div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full spinner mx-auto mb-4"></div>
				<p class="text-gray-600">æ­£åœ¨åŠ è½½å’Œå¯¹æ¯”æ•°æ®...</p>
			</div>
		</div>

		<!-- é”™è¯¯æ¶ˆæ¯ -->
		<div x-show="errorMessage" class="max-w-4xl mx-auto mb-8">
			<div class="bg-red-50 border border-red-200 rounded-xl p-4 flex items-center">
				<svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
				</svg>
				<span class="text-red-700" x-text="errorMessage"></span>
			</div>
		</div>

		<!-- å¯¹æ¯”ç»“æœ -->
		<div x-show="showResults" class="max-w-6xl mx-auto fade-in">
			<!-- æŠ¥å‘Šç”ŸæˆæŒ‰é’® -->
			<div class="mb-6 text-center">
				<div class="bg-white rounded-xl shadow-lg p-4">
					<h3 class="text-lg font-semibold text-gray-800 mb-3">ç”Ÿæˆèˆªç­å·®å¼‚æŠ¥å‘Š</h3>
					<div class="flex flex-wrap justify-center gap-3">
						<button @click="generateHtmlReport()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
							<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
							</svg>
							ä¸‹è½½å¡ç‰‡å¼æŠ¥å‘Š
						</button>
						<button @click="previewHtmlReport()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
							<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
							</svg>
							é¢„è§ˆæŠ¥å‘Š
						</button>
					</div>
				</div>
			</div>

			<!-- æ‘˜è¦å¡ç‰‡ -->
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
				<div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
					<div class="flex items-center">
						<div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
							<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
							</svg>
						</div>
						<div>
							<div class="text-3xl font-bold" x-text="addedFlights.length"></div>
							<div class="text-green-100">æ–°å¢èˆªç­</div>
						</div>
					</div>
				</div>
				<div class="bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl shadow-lg p-6 text-white">
					<div class="flex items-center">
						<div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
							<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
							</svg>
						</div>
						<div>
							<div class="text-3xl font-bold" x-text="modifiedFlights.length"></div>
							<div class="text-yellow-100">èˆªç­è°ƒæ•´</div>
						</div>
					</div>
				</div>
				<div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
					<div class="flex items-center">
						<div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
							<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
							</svg>
						</div>
						<div>
							<div class="text-3xl font-bold" x-text="removedFlights.length"></div>
							<div class="text-red-100">åˆ é™¤èˆªç­</div>
						</div>
					</div>
				</div>
			</div>

			<!-- æ ‡ç­¾é¡µ -->
			<div class="bg-white rounded-xl shadow-lg overflow-hidden">
				<div class="flex border-b">
					<button @click="activeTab = 'added'" :class="activeTab === 'added' ? 'bg-green-50 text-green-700 border-b-2 border-green-500' : 'text-gray-600 hover:text-gray-800'" class="flex-1 px-4 py-4 font-semibold transition-colors text-sm md:text-base">
						æ–°å¢èˆªç­ (<span x-text="addedFlights.length"></span>)
					</button>
					<button @click="activeTab = 'modified'" :class="activeTab === 'modified' ? 'bg-yellow-50 text-yellow-700 border-b-2 border-yellow-500' : 'text-gray-600 hover:text-gray-800'" class="flex-1 px-4 py-4 font-semibold transition-colors text-sm md:text-base">
						èˆªç­è°ƒæ•´ (<span x-text="modifiedFlights.length"></span>)
					</button>
					<button @click="activeTab = 'removed'" :class="activeTab === 'removed' ? 'bg-red-50 text-red-700 border-b-2 border-red-500' : 'text-gray-600 hover:text-gray-800'" class="flex-1 px-4 py-4 font-semibold transition-colors text-sm md:text-base">
						åˆ é™¤èˆªç­ (<span x-text="removedFlights.length"></span>)
					</button>
				</div>

				<!-- æ–°å¢èˆªç­å†…å®¹ -->
				<div x-show="activeTab === 'added'" class="p-6">
					<template x-if="addedFlights.length === 0">
						<div class="text-center py-12 text-gray-500">
							<svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
							<p class="text-lg">æ²¡æœ‰æ–°å¢çš„èˆªç­</p>
						</div>
					</template>
					<template x-if="addedFlights.length > 0">
						<div>
							<template x-for="(cityGroup, city) in groupedAddedFlights" :key="city">
								<div class="mb-8">
									<h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
										<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm mr-3" x-text="cityGroup.length"></span>
										<span x-text="city"></span>
									</h3>
									<div class="grid gap-4">
										<template x-for="flight in cityGroup" :key="getFlightKey(flight)">
											<div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-4 hover:shadow-md transition-shadow">
												<div class="mb-3">
													<div class="font-bold text-lg text-gray-800" x-text="this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + ' [' + flight.èˆªç­å· + ']'"></div>
												</div>
												<div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
													<div>
														<span class="font-semibold text-gray-700">èµ·é£æ—¶é—´ï¼š</span>
														<span x-text="this.getDepartureTime(flight)"></span>
													</div>
													<div>
														<span class="font-semibold text-gray-700">ç­æœŸï¼š</span>
														<span x-text="flight.ç­æœŸ"></span>
													</div>
													<div>
														<span class="font-semibold text-gray-700">äº§å“åˆ†ç±»ï¼š</span>
														<span x-text="getProductCategory(flight)"></span>
													</div>
												</div>
											</div>
										</template>
									</div>
								</div>
							</template>
						</div>
					</template>
				</div>

				<!-- èˆªç­è°ƒæ•´å†…å®¹ -->
				<div x-show="activeTab === 'modified'" class="p-6">
					<template x-if="modifiedFlights.length === 0">
						<div class="text-center py-12 text-gray-500">
							<svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
							<p class="text-lg">æ²¡æœ‰è°ƒæ•´çš„èˆªç­</p>
						</div>
					</template>
					<template x-if="modifiedFlights.length > 0">
						<div>
							<template x-for="(cityGroup, city) in groupedModifiedFlights" :key="city">
								<div class="mb-8">
									<h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
										<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm mr-3" x-text="cityGroup.length"></span>
										<span x-text="city"></span>
									</h3>
									<div class="grid gap-4">
										<template x-for="flightPair in cityGroup" :key="getFlightKey(flightPair.old)">
											<div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-lg p-4 hover:shadow-md transition-shadow">
												<div class="mb-3">
													<div class="font-bold text-lg text-gray-800" x-text="this.getDepartureAirport(flightPair.old) + ' â†’ ' + this.getArrivalAirport(flightPair.old) + ' [' + flightPair.old.èˆªç­å· + ']'"></div>
												</div>

												<!-- å˜æ›´å¯¹æ¯” -->
												<div class="space-y-3">
													<template x-for="change in flightPair.changes" :key="change.field">
														<div class="bg-white rounded-lg p-3 border">
															<div class="text-sm font-semibold text-gray-700 mb-2" x-text="change.label + 'å˜æ›´ï¼š'"></div>
															<div class="flex flex-col md:flex-row md:items-center gap-2">
																<div class="flex items-center">
																	<span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded mr-2">åŸå€¼</span>
																	<span class="text-red-700" x-text="change.oldValue"></span>
																</div>
																<svg class="w-4 h-4 text-gray-400 mx-2 hidden md:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
																	<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
																</svg>
																<div class="flex items-center">
																	<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded mr-2">æ–°å€¼</span>
																	<span class="text-green-700" x-text="change.newValue"></span>
																</div>
															</div>
														</div>
													</template>
												</div>
											</div>
										</template>
									</div>
								</div>
							</template>
						</div>
					</template>
				</div>

				<!-- åˆ é™¤èˆªç­å†…å®¹ -->
				<div x-show="activeTab === 'removed'" class="p-6">
					<template x-if="removedFlights.length === 0">
						<div class="text-center py-12 text-gray-500">
							<svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
							<p class="text-lg">æ²¡æœ‰åˆ é™¤çš„èˆªç­</p>
						</div>
					</template>
					<template x-if="removedFlights.length > 0">
						<div>
							<template x-for="(cityGroup, city) in groupedRemovedFlights" :key="city">
								<div class="mb-8">
									<h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
										<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm mr-3" x-text="cityGroup.length"></span>
										<span x-text="city"></span>
									</h3>
									<div class="grid gap-4">
										<template x-for="flight in cityGroup" :key="getFlightKey(flight)">
											<div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4 hover:shadow-md transition-shadow">
												<div class="mb-3">
													<div class="font-bold text-lg text-gray-800" x-text="this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + ' [' + flight.èˆªç­å· + ']'"></div>
												</div>
												<div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
													<div>
														<span class="font-semibold text-gray-700">èµ·é£æ—¶é—´ï¼š</span>
														<span x-text="getDepartureTime(flight)"></span>
													</div>
													<div>
														<span class="font-semibold text-gray-700">ç­æœŸï¼š</span>
														<span x-text="flight.ç­æœŸ"></span>
													</div>
													<div>
														<span class="font-semibold text-gray-700">äº§å“åˆ†ç±»ï¼š</span>
														<span x-text="getProductCategory(flight)"></span>
													</div>
												</div>
											</div>
										</template>
									</div>
								</div>
							</template>
						</div>
					</template>
				</div>
			</div>
		</div>
	</div>

	<script>
		function diffApp() {
			return {
				availableFiles: [],
				file1: '',
				file2: '',
				loading: false,
				showResults: false,
				errorMessage: '',
				activeTab: 'added',
				addedFlights: [],
				removedFlights: [],
				modifiedFlights: [],
				groupedAddedFlights: {},
				groupedRemovedFlights: {},
				groupedModifiedFlights: {},

				async init() {
					await this.loadAvailableFiles();
				},

				get canCompare() {
					return this.file1 && this.file2 && this.file1 !== this.file2;
				},

				async loadAvailableFiles() {
					try {
						// æ–¹æ³•1: å°è¯•é€šè¿‡GitHub APIè·å–æ–‡ä»¶åˆ—è¡¨ï¼ˆé€‚ç”¨äºGitHub Pagesï¼‰
						if (window.location.hostname.includes('github.io')) {
							await this.loadFilesFromGitHubAPI();
						} else {
							// æ–¹æ³•2: å°è¯•é€šè¿‡ç›®å½•ç´¢å¼•è·å–æ–‡ä»¶åˆ—è¡¨ï¼ˆé€‚ç”¨äºæœ¬åœ°æœåŠ¡å™¨ï¼‰
							await this.loadFilesFromDirectory();
						}
					} catch (error) {
						console.warn('åŠ¨æ€åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥ï¼Œä½¿ç”¨é¢„å®šä¹‰åˆ—è¡¨:', error);
						// åå¤‡æ–¹æ¡ˆï¼šä½¿ç”¨é¢„å®šä¹‰çš„æ–‡ä»¶åˆ—è¡¨
						this.availableFiles = ['20250828.json', '20250906.json'];
					}
				},

				async loadFilesFromGitHubAPI() {
					try {
						// ç›´æ¥ä½¿ç”¨æ­£ç¡®çš„ä»“åº“ä¿¡æ¯ï¼Œä¸ä¾èµ–URLè§£æ
						const owner = 'braumye';
						const repo = 'hnair-plus-route';

						console.log(`å°è¯•è®¿é—®ä»“åº“: ${owner}/${repo}`);
						console.log(`å½“å‰URL: ${window.location.href}`);

						// å°è¯•ä¸åŒçš„APIç«¯ç‚¹
						const apiUrls = [
							`https://api.github.com/repos/${owner}/${repo}/contents/json`,
							`https://api.github.com/repos/${owner}/${repo}/contents/json?ref=main`,
							`https://api.github.com/repos/${owner}/${repo}/contents/json?ref=master`
						];

						for (const apiUrl of apiUrls) {
							console.log(`å°è¯•API: ${apiUrl}`);
							const response = await fetch(apiUrl);

							if (response.ok) {
								const files = await response.json();
								this.availableFiles = files
									.filter(file => file.name.endsWith('.json') && file.name !== 'latest.json')
									.map(file => file.name)
									.sort();
								console.log('æˆåŠŸè·å–æ–‡ä»¶åˆ—è¡¨:', this.availableFiles);
								return;
							} else {
								console.log(`APIå¤±è´¥ (${response.status}): ${apiUrl}`);
								if (response.status === 404) {
									console.log('å¯èƒ½çš„åŸå› : 1) ä»“åº“ä¸å­˜åœ¨ 2) jsonæ–‡ä»¶å¤¹ä¸å­˜åœ¨ 3) ä»“åº“æ˜¯ç§æœ‰çš„');
								}
							}
						}

						throw new Error(`æ‰€æœ‰APIç«¯ç‚¹éƒ½å¤±è´¥äº†ã€‚è¯·æ£€æŸ¥ä»“åº“ ${owner}/${repo} æ˜¯å¦å­˜åœ¨ä¸”åŒ…å«jsonæ–‡ä»¶å¤¹`);

					} catch (error) {
						console.error('GitHub APIé”™è¯¯:', error);
						throw new Error(`GitHub API è·å–å¤±è´¥: ${error.message}`);
					}
				},

				async loadFilesFromDirectory() {
					// æ–¹æ³•1: å°è¯•è·å–jsonç›®å½•çš„æ–‡ä»¶åˆ—è¡¨
					try {
						const response = await fetch('./json/');

						if (response.ok) {
							const html = await response.text();
							// è§£æHTMLä¸­çš„æ–‡ä»¶é“¾æ¥
							const parser = new DOMParser();
							const doc = parser.parseFromString(html, 'text/html');
							const links = doc.querySelectorAll('a[href]');

							const jsonFiles = [];
							links.forEach(link => {
								const href = link.getAttribute('href');
								if (href && href.endsWith('.json') && href !== 'latest.json') {
									jsonFiles.push(href);
								}
							});

							if (jsonFiles.length > 0) {
								this.availableFiles = jsonFiles.sort();
								return;
							}
						}
					} catch (error) {
						console.warn('ç›®å½•ç´¢å¼•æ–¹æ³•å¤±è´¥:', error);
					}

					// æ–¹æ³•2: å°è¯•é€šè¿‡æ—¥æœŸæ¨¡å¼å‘ç°æ–‡ä»¶
					await this.discoverFilesByPattern();
				},

				async discoverFilesByPattern() {
					const discoveredFiles = [];
					const currentYear = new Date().getFullYear();
					const currentMonth = new Date().getMonth() + 1;

					// ç”Ÿæˆå¯èƒ½çš„æ–‡ä»¶åï¼ˆè¿‡å»6ä¸ªæœˆåˆ°æœªæ¥1ä¸ªæœˆï¼‰
					const possibleFiles = [];

					for (let monthOffset = -6; monthOffset <= 1; monthOffset++) {
						const date = new Date(currentYear, currentMonth - 1 + monthOffset, 1);
						const year = date.getFullYear();
						const month = String(date.getMonth() + 1).padStart(2, '0');

						// ç”Ÿæˆè¯¥æœˆçš„æ‰€æœ‰å¯èƒ½æ—¥æœŸ
						const daysInMonth = new Date(year, date.getMonth() + 1, 0).getDate();
						for (let day = 1; day <= daysInMonth; day++) {
							const dayStr = String(day).padStart(2, '0');
							possibleFiles.push(`${year}${month}${dayStr}.json`);
						}
					}

					// å¹¶å‘æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆé™åˆ¶å¹¶å‘æ•°é‡ä»¥é¿å…è¿‡å¤šè¯·æ±‚ï¼‰
					const batchSize = 10;
					for (let i = 0; i < possibleFiles.length; i += batchSize) {
						const batch = possibleFiles.slice(i, i + batchSize);
						const results = await Promise.allSettled(
							batch.map(async (filename) => {
								try {
									const response = await fetch(`./json/${filename}`, {
										method: 'HEAD'
									});
									return response.ok ? filename : null;
								} catch {
									return null;
								}
							})
						);

						results.forEach((result, index) => {
							if (result.status === 'fulfilled' && result.value) {
								discoveredFiles.push(result.value);
							}
						});

						// æ·»åŠ å°å»¶è¿Ÿä»¥é¿å…è¿‡äºé¢‘ç¹çš„è¯·æ±‚
						if (i + batchSize < possibleFiles.length) {
							await new Promise(resolve => setTimeout(resolve, 100));
						}
					}

					if (discoveredFiles.length > 0) {
						this.availableFiles = discoveredFiles.sort().reverse(); // æœ€æ–°çš„æ–‡ä»¶åœ¨å‰
					} else {
						throw new Error('æœªå‘ç°ä»»ä½•æ–‡ä»¶');
					}
				},

				checkCompareButton() {
					// é‡ç½®ç»“æœæ˜¾ç¤º
					this.showResults = false;
					this.errorMessage = '';
				},

				async compareFiles() {
					if (!this.canCompare) return;

					this.loading = true;
					this.showResults = false;
					this.errorMessage = '';

					try {
						const [data1, data2] = await Promise.all([
							this.loadJsonFile(this.file1),
							this.loadJsonFile(this.file2)
						]);

						const diffResult = this.analyzeDifferences(data1, data2);
						this.addedFlights = diffResult.added;
						this.removedFlights = diffResult.removed;
						this.modifiedFlights = diffResult.modified;

						// æŒ‰å‡ºå‘åŸå¸‚åˆ†ç»„
						this.groupedAddedFlights = this.groupFlightsByCity(this.addedFlights);
						this.groupedRemovedFlights = this.groupFlightsByCity(this.removedFlights);
						this.groupedModifiedFlights = this.groupModifiedFlightsByCity(this.modifiedFlights);

						this.showResults = true;
						// ä¼˜å…ˆæ˜¾ç¤ºæœ‰æ•°æ®çš„æ ‡ç­¾é¡µ
						if (this.addedFlights.length > 0) {
							this.activeTab = 'added';
						} else if (this.modifiedFlights.length > 0) {
							this.activeTab = 'modified';
						} else {
							this.activeTab = 'removed';
						}

					} catch (error) {
						console.error('æ¯”è¾ƒæ–‡ä»¶æ—¶å‡ºé”™:', error);
						this.errorMessage = 'æ¯”è¾ƒæ–‡ä»¶æ—¶å‡ºç°é”™è¯¯: ' + error.message;
					} finally {
						this.loading = false;
					}
				},

				async loadJsonFile(filename) {
					const response = await fetch(`./json/${filename}`);
					if (!response.ok) {
						throw new Error(`æ— æ³•åŠ è½½æ–‡ä»¶ ${filename}: ${response.statusText}`);
					}
					return await response.json();
				},

				analyzeDifferences(data1, data2) {
					const flights1 = this.extractFlights(data1);
					const flights2 = this.extractFlights(data2);

					// ä½¿ç”¨èˆªç­å·+èµ·é£æœºåœº+é™è½æœºåœºä½œä¸ºåŸºç¡€æ ‡è¯†
					const baseFlightMap1 = new Map();
					const baseFlightMap2 = new Map();

					// ä½¿ç”¨å®Œæ•´ä¿¡æ¯ä½œä¸ºè¯¦ç»†æ ‡è¯†
					const fullFlightMap1 = new Map();
					const fullFlightMap2 = new Map();

					flights1.forEach(flight => {
						const baseKey = this.getBaseFlightKey(flight);
						const fullKey = this.getFlightKey(flight);
						baseFlightMap1.set(baseKey, flight);
						fullFlightMap1.set(fullKey, flight);
					});

					flights2.forEach(flight => {
						const baseKey = this.getBaseFlightKey(flight);
						const fullKey = this.getFlightKey(flight);
						baseFlightMap2.set(baseKey, flight);
						fullFlightMap2.set(fullKey, flight);
					});

					const added = [];
					const removed = [];
					const modified = [];

					// æ‰¾å‡ºæ–°å¢çš„èˆªç­ï¼ˆåŸºç¡€æ ‡è¯†åœ¨data2ä¸­ä½†ä¸åœ¨data1ä¸­ï¼‰
					baseFlightMap2.forEach((flight, baseKey) => {
						if (!baseFlightMap1.has(baseKey)) {
							added.push(flight);
						}
					});

					// æ‰¾å‡ºåˆ é™¤çš„èˆªç­ï¼ˆåŸºç¡€æ ‡è¯†åœ¨data1ä¸­ä½†ä¸åœ¨data2ä¸­ï¼‰
					baseFlightMap1.forEach((flight, baseKey) => {
						if (!baseFlightMap2.has(baseKey)) {
							removed.push(flight);
						}
					});

					// æ‰¾å‡ºè°ƒæ•´çš„èˆªç­ï¼ˆåŸºç¡€æ ‡è¯†ç›¸åŒä½†å®Œæ•´ä¿¡æ¯ä¸åŒï¼‰
					baseFlightMap1.forEach((oldFlight, baseKey) => {
						if (baseFlightMap2.has(baseKey)) {
							const newFlight = baseFlightMap2.get(baseKey);
							const oldFullKey = this.getFlightKey(oldFlight);
							const newFullKey = this.getFlightKey(newFlight);

							if (oldFullKey !== newFullKey) {
								const changes = this.getFlightChanges(oldFlight, newFlight);
								modified.push({
									old: oldFlight,
									new: newFlight,
									changes: changes
								});
							}
						}
					});

					return {
						added: added.sort((a, b) => a.èˆªç­å·.localeCompare(b.èˆªç­å·)),
						removed: removed.sort((a, b) => a.èˆªç­å·.localeCompare(b.èˆªç­å·)),
						modified: modified.sort((a, b) => a.old.èˆªç­å·.localeCompare(b.old.èˆªç­å·))
					};
				},

				extractFlights(data) {
					if (data.tables && data.tables.length > 0) {
						return data.tables[0].rows || [];
					}
					return [];
				},

				getFlightKey(flight) {
					return `${flight.èˆªç­å·}-${this.getDepartureAirport(flight)}-${this.getArrivalAirport(flight)}-${this.getDepartureTime(flight)}`;
				},

				groupFlightsByCity(flights) {
					const grouped = {};
					flights.forEach(flight => {
						const city = this.getDepartureAirport(flight);
						if (!grouped[city]) {
							grouped[city] = [];
						}
						grouped[city].push(flight);
					});

					// æŒ‰åŸå¸‚åç§°æ’åº
					const sortedGrouped = {};
					Object.keys(grouped).sort().forEach(city => {
						sortedGrouped[city] = grouped[city];
					});

					return sortedGrouped;
				},

				getProductCategory(flight) {
					// ä¼˜å…ˆä½¿ç”¨"äº§å“åˆ†ç±»"ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨"é€‚ç”¨äº§å“"
					return flight.äº§å“åˆ†ç±» || flight.é€‚ç”¨äº§å“ || 'æœªçŸ¥';
				},

				// è·å–èµ·é£æœºåœº
				getDepartureAirport(flight) {
					return flight.èµ·é£æœºåœº || flight.å‡ºæ¸¯åŸå¸‚ || 'æœªçŸ¥';
				},

				// è·å–é™è½æœºåœº
				getArrivalAirport(flight) {
					return flight.é™è½æœºåœº || flight.åˆ°æ¸¯åŸå¸‚ || 'æœªçŸ¥';
				},

				// è·å–èµ·é£æ—¶é—´
				getDepartureTime(flight) {
					return flight.èµ·é£æ—¶é—´ || flight.å‡ºå‘æ—¶åˆ» || 'æœªçŸ¥';
				},

				generateHtmlReport() {
					const reportData = this.prepareReportData();
					this.downloadHtmlReport(reportData);
				},

				previewHtmlReport() {
					const reportData = this.prepareReportData();
					const content = this.generateSimpleReport(reportData);

					// åˆ›å»ºé¢„è§ˆçª—å£
					const previewWindow = window.open('', '_blank', 'width=1200,height=800');
					const html = '<html><head><title>èˆªç­å·®å¼‚æŠ¥å‘Šé¢„è§ˆ</title><style>body{font-family:Arial,sans-serif;padding:20px;line-height:1.6;background:#f5f5f5;}h1,h2,h3{color:#333;}.summary{background:white;padding:20px;border-radius:8px;margin:20px 0;box-shadow:0 2px 4px rgba(0,0,0,0.1);}.card{background:white;padding:15px;margin:10px 0;border-radius:8px;border-left:4px solid #007bff;}.added{border-left-color:#28a745;}.modified{border-left-color:#ffc107;}.removed{border-left-color:#dc3545;}.flight-info{margin:5px 0;font-size:14px;}.change{background:#f8f9fa;padding:8px;margin:5px 0;border-radius:4px;}</style></head><body>' + content + '</body></html>';
					previewWindow.document.write(html);
					previewWindow.document.close();
				},

				prepareReportData() {
					const now = new Date();
					return {
						metadata: {
							generatedAt: now.toLocaleString('zh-CN'),
							file1: this.file1,
							file2: this.file2,
							totalAdded: this.addedFlights.length,
							totalModified: this.modifiedFlights.length,
							totalRemoved: this.removedFlights.length
						},
						addedFlights: this.addedFlights,
						modifiedFlights: this.modifiedFlights,
						removedFlights: this.removedFlights,
						groupedAddedFlights: this.groupedAddedFlights,
						groupedModifiedFlights: this.groupedModifiedFlights,
						groupedRemovedFlights: this.groupedRemovedFlights
					};
				},

				downloadMarkdownReport(data) {
					let markdown = '# èˆªç­æ•°æ®å·®å¼‚æŠ¥å‘Š\n\n';
					markdown += '**ç”Ÿæˆæ—¶é—´**: ' + data.metadata.generatedAt + '\n';
					markdown += '**å¯¹æ¯”æ–‡ä»¶**: ' + data.metadata.file1 + ' vs ' + data.metadata.file2 + '\n\n';

					// æ‘˜è¦
					markdown += '## ğŸ“Š å¯¹æ¯”æ‘˜è¦\n\n';
					markdown += '| å˜æ›´ç±»å‹ | æ•°é‡ |\n';
					markdown += '|---------|------|\n';
					markdown += '| ğŸŸ¢ æ–°å¢èˆªç­ | ' + data.metadata.totalAdded + ' |\n';
					markdown += '| ğŸŸ¡ èˆªç­è°ƒæ•´ | ' + data.metadata.totalModified + ' |\n';
					markdown += '| ğŸ”´ åˆ é™¤èˆªç­ | ' + data.metadata.totalRemoved + ' |\n\n';

					// æ–°å¢èˆªç­
					if (data.metadata.totalAdded > 0) {
						markdown += '## âœˆï¸ æ–°å¢èˆªç­ (' + data.metadata.totalAdded + ')\n\n';
						Object.entries(data.groupedAddedFlights).forEach(([city, flights]) => {
							markdown += '### ' + city + ' (' + flights.length + 'ç­)\n\n';
							flights.forEach(flight => {
								markdown += '- **' + flight.èˆªç­å· + '**: ' + this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + '\n';
								markdown += '  - èµ·é£æ—¶é—´: ' + this.getDepartureTime(flight) + '\n';
								markdown += '  - ç­æœŸ: ' + flight.ç­æœŸ + '\n';
								markdown += '  - äº§å“åˆ†ç±»: ' + this.getProductCategory(flight) + '\n\n';
							});
						});
					}

					// èˆªç­è°ƒæ•´
					if (data.metadata.totalModified > 0) {
						markdown += '## ğŸ”„ èˆªç­è°ƒæ•´ (' + data.metadata.totalModified + ')\n\n';
						Object.entries(data.groupedModifiedFlights).forEach(([city, flightPairs]) => {
							markdown += '### ' + city + ' (' + flightPairs.length + 'ç­)\n\n';
							flightPairs.forEach(pair => {
								markdown += '- **' + pair.old.èˆªç­å· + '**: ' + this.getDepartureAirport(pair.old) + ' â†’ ' + this.getArrivalAirport(pair.old) + '\n';
								pair.changes.forEach(change => {
									markdown += '  - ' + change.label + ': ' + change.oldValue + ' â†’ ' + change.newValue + '\n';
								});
								markdown += '\n';
							});
						});
					}

					// åˆ é™¤èˆªç­
					if (data.metadata.totalRemoved > 0) {
						markdown += '## âŒ åˆ é™¤èˆªç­ (' + data.metadata.totalRemoved + ')\n\n';
						Object.entries(data.groupedRemovedFlights).forEach(([city, flights]) => {
							markdown += '### ' + city + ' (' + flights.length + 'ç­)\n\n';
							flights.forEach(flight => {
								markdown += '- **' + flight.èˆªç­å· + '**: ' + this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + '\n';
								markdown += '  - èµ·é£æ—¶é—´: ' + this.getDepartureTime(flight) + '\n';
								markdown += '  - ç­æœŸ: ' + flight.ç­æœŸ + '\n';
								markdown += '  - äº§å“åˆ†ç±»: ' + this.getProductCategory(flight) + '\n\n';
							});
						});
					}

					const filename = 'èˆªç­å·®å¼‚æŠ¥å‘Š_' + data.metadata.file1 + '_vs_' + data.metadata.file2 + '.md';
					this.downloadFile(markdown, filename, 'text/markdown');
				},

				downloadHtmlReport(data) {
					const reportTitle = 'èˆªç­æ•°æ®å·®å¼‚æŠ¥å‘Š';
					const filename = `èˆªç­å·®å¼‚æŠ¥å‘Š_${data.metadata.file1}_vs_${data.metadata.file2}.html`;

					let html = '<!DOCTYPE html>\n';
					html += '<html lang="zh-CN">\n';
					html += '<head>\n';
					html += '    <meta charset="UTF-8">\n';
					html += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
					html += '    <title>' + reportTitle + '</title>\n';
					html += '    <script src="https://cdn.tailwindcss.com"' + '> ' + '<' + '/script>';
					html += '    <style>\n';
					html += '        @media print { .no-print { display: none !important; } }\n';
					html += '    </style>\n';
					html += '</head>\n';
					html += '<body class="bg-gray-50 p-8">\n';
					html += '    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8">\n';
					html += '        <header class="text-center mb-8 border-b pb-6">\n';
					html += '            <h1 class="text-3xl font-bold text-gray-800 mb-2">' + reportTitle + '</h1>\n';
					html += '            <p class="text-gray-600">ç”Ÿæˆæ—¶é—´: ' + data.metadata.generatedAt + '</p>\n';
					html += '            <p class="text-gray-600">å¯¹æ¯”æ–‡ä»¶: ' + data.metadata.file1 + ' vs ' + data.metadata.file2 + '</p>\n';
					html += '        </header>\n';
					html += '        <div class="mb-8">\n';
					html += '            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“Š å¯¹æ¯”æ‘˜è¦</h2>\n';
					html += '            <div class="grid grid-cols-3 gap-4">\n';
					html += '                <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">\n';
					html += '                    <div class="text-2xl font-bold text-green-600">' + data.metadata.totalAdded + '</div>\n';
					html += '                    <div class="text-green-700">æ–°å¢èˆªç­</div>\n';
					html += '                </div>\n';
					html += '                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">\n';
					html += '                    <div class="text-2xl font-bold text-yellow-600">' + data.metadata.totalModified + '</div>\n';
					html += '                    <div class="text-yellow-700">èˆªç­è°ƒæ•´</div>\n';
					html += '                </div>\n';
					html += '                <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">\n';
					html += '                    <div class="text-2xl font-bold text-red-600">' + data.metadata.totalRemoved + '</div>\n';
					html += '                    <div class="text-red-700">åˆ é™¤èˆªç­</div>\n';
					html += '                </div>\n';
					html += '            </div>\n';
					html += '        </div>\n';

					// æ–°å¢èˆªç­è¯¦æƒ…
					if (data.metadata.totalAdded > 0) {
						html += '        <div class="mb-8">\n';
						html += '            <h2 class="text-2xl font-bold text-gray-800 mb-4">âœˆï¸ æ–°å¢èˆªç­</h2>\n';
						Object.entries(data.groupedAddedFlights).forEach(([city, flights]) => {
							html += '            <div class="mb-6">\n';
							html += '                <h3 class="text-xl font-semibold text-gray-700 mb-3">' + city + ' (' + flights.length + 'ç­)</h3>\n';
							html += '                <div class="space-y-2">\n';
							flights.forEach(flight => {
								html += '                    <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded">\n';
								html += '                        <div class="font-semibold">' + flight.èˆªç­å· + ': ' + this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + '</div>\n';
								html += '                        <div class="text-sm text-gray-600">èµ·é£æ—¶é—´: ' + this.getDepartureTime(flight) + ' | ç­æœŸ: ' + flight.ç­æœŸ + ' | äº§å“åˆ†ç±»: ' + this.getProductCategory(flight) + '</div>\n';
								html += '                    </div>\n';
							});
							html += '                </div>\n';
							html += '            </div>\n';
						});
						html += '        </div>\n';
					}

					html += '        <div class="no-print mt-8 text-center">\n';
					html += '            <button onclick="window.print()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">æ‰“å°æŠ¥å‘Š</button>\n';
					html += '        </div>\n';
					html += '    </div>\n';
					html += '</body>\n';
					html += '</html>';

					this.downloadFile(html, filename, 'text/html');
				},

				downloadJsonReport(data) {
					const jsonData = JSON.stringify(data, null, 2);
					this.downloadFile(jsonData, `èˆªç­å·®å¼‚æ•°æ®_${data.metadata.file1}_vs_${data.metadata.file2}.json`, 'application/json');
				},

				downloadFile(content, filename, mimeType) {
					const blob = new Blob([content], {
						type: mimeType
					});
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					document.body.appendChild(a);
					a.click();
					document.body.removeChild(a);
					URL.revokeObjectURL(url);
				},

				previewReport() {
					const reportData = this.prepareReportData();
					const content = this.generateSimpleReport(reportData);

					// åˆ›å»ºé¢„è§ˆçª—å£
					const previewWindow = window.open('', '_blank', 'width=800,height=600');
					const html = '<html><head><title>æŠ¥å‘Šé¢„è§ˆ</title><style>body{font-family:Arial,sans-serif;padding:20px;line-height:1.6;}h1,h2,h3{color:#333;}table{border-collapse:collapse;width:100%;margin:1em 0;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background-color:#f2f2f2;}</style></head><body>' + content + '</body></html>';
					previewWindow.document.write(html);
					previewWindow.document.close();
				},

				generateSimpleReport(data) {
					let html = '<h1>èˆªç­æ•°æ®å·®å¼‚æŠ¥å‘Š</h1>';
					html += '<div class="summary">';
					html += '<p><strong>ç”Ÿæˆæ—¶é—´:</strong> ' + data.metadata.generatedAt + '</p>';
					html += '<p><strong>å¯¹æ¯”æ–‡ä»¶:</strong> ' + data.metadata.file1 + ' vs ' + data.metadata.file2 + '</p>';
					html += '<h2>ğŸ“Š å¯¹æ¯”æ‘˜è¦</h2>';
					html += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:20px 0;">';
					html += '<div style="background:#d4edda;padding:15px;border-radius:8px;text-align:center;"><h3 style="margin:0;color:#155724;">âœˆï¸ æ–°å¢èˆªç­</h3><div style="font-size:24px;font-weight:bold;color:#155724;">' + data.metadata.totalAdded + '</div></div>';
					html += '<div style="background:#fff3cd;padding:15px;border-radius:8px;text-align:center;"><h3 style="margin:0;color:#856404;">ğŸ”„ èˆªç­è°ƒæ•´</h3><div style="font-size:24px;font-weight:bold;color:#856404;">' + data.metadata.totalModified + '</div></div>';
					html += '<div style="background:#f8d7da;padding:15px;border-radius:8px;text-align:center;"><h3 style="margin:0;color:#721c24;">âŒ åˆ é™¤èˆªç­</h3><div style="font-size:24px;font-weight:bold;color:#721c24;">' + data.metadata.totalRemoved + '</div></div>';
					html += '</div>';
					html += '</div>';

					// æ–°å¢èˆªç­è¯¦æƒ…
					if (data.metadata.totalAdded > 0) {
						html += '<h2>âœˆï¸ æ–°å¢èˆªç­è¯¦æƒ…</h2>';
						Object.entries(data.groupedAddedFlights).forEach(([city, flights]) => {
							html += '<h3>' + city + ' (' + flights.length + 'ç­)</h3>';
							flights.forEach(flight => {
								html += '<div class="card added">';
								html += '<div style="font-weight:bold;font-size:16px;margin-bottom:8px;">' + flight.èˆªç­å· + ': ' + this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + '</div>';
								html += '<div class="flight-info">èµ·é£æ—¶é—´: ' + this.getDepartureTime(flight) + '</div>';
								html += '<div class="flight-info">ç­æœŸ: ' + flight.ç­æœŸ + '</div>';
								html += '<div class="flight-info">äº§å“åˆ†ç±»: ' + this.getProductCategory(flight) + '</div>';
								html += '</div>';
							});
						});
					}

					// èˆªç­è°ƒæ•´è¯¦æƒ…
					if (data.metadata.totalModified > 0) {
						html += '<h2>ğŸ”„ èˆªç­è°ƒæ•´è¯¦æƒ…</h2>';
						Object.entries(data.groupedModifiedFlights).forEach(([city, flightPairs]) => {
							html += '<h3>' + city + ' (' + flightPairs.length + 'ç­)</h3>';
							flightPairs.forEach(pair => {
								html += '<div class="card modified">';
								html += '<div style="font-weight:bold;font-size:16px;margin-bottom:8px;">' + pair.old.èˆªç­å· + ': ' + this.getDepartureAirport(pair.old) + ' â†’ ' + this.getArrivalAirport(pair.old) + '</div>';
								pair.changes.forEach(change => {
									html += '<div class="change">';
									html += '<strong>' + change.label + 'å˜æ›´:</strong> ';
									html += '<span style="color:#dc3545;">' + change.oldValue + '</span> â†’ ';
									html += '<span style="color:#28a745;">' + change.newValue + '</span>';
									html += '</div>';
								});
								html += '</div>';
							});
						});
					}

					// åˆ é™¤èˆªç­è¯¦æƒ…
					if (data.metadata.totalRemoved > 0) {
						html += '<h2>âŒ åˆ é™¤èˆªç­è¯¦æƒ…</h2>';
						Object.entries(data.groupedRemovedFlights).forEach(([city, flights]) => {
							html += '<h3>' + city + ' (' + flights.length + 'ç­)</h3>';
							flights.forEach(flight => {
								html += '<div class="card removed">';
								html += '<div style="font-weight:bold;font-size:16px;margin-bottom:8px;">' + flight.èˆªç­å· + ': ' + this.getDepartureAirport(flight) + ' â†’ ' + this.getArrivalAirport(flight) + '</div>';
								html += '<div class="flight-info">èµ·é£æ—¶é—´: ' + this.getDepartureTime(flight) + '</div>';
								html += '<div class="flight-info">ç­æœŸ: ' + flight.ç­æœŸ + '</div>';
								html += '<div class="flight-info">äº§å“åˆ†ç±»: ' + this.getProductCategory(flight) + '</div>';
								html += '</div>';
							});
						});
					}

					return html;
				},

				getBaseFlightKey(flight) {
					// åŸºç¡€æ ‡è¯†ï¼šèˆªç­å·+èµ·é£æœºåœº+é™è½æœºåœº
					return `${flight.èˆªç­å·}-${this.getDepartureAirport(flight)}-${this.getArrivalAirport(flight)}`;
				},

				getFlightChanges(oldFlight, newFlight) {
					const changes = [];
					const fieldMap = {
						'èµ·é£æ—¶é—´': 'èµ·é£æ—¶é—´',
						'ç­æœŸ': 'ç­æœŸ',
						'äº§å“åˆ†ç±»': 'äº§å“åˆ†ç±»'
					};

					// æ£€æŸ¥èµ·é£æ—¶é—´å˜æ›´
					if (this.getDepartureTime(oldFlight) !== this.getDepartureTime(newFlight)) {
						changes.push({
							field: 'èµ·é£æ—¶é—´',
							label: 'èµ·é£æ—¶é—´',
							oldValue: this.getDepartureTime(oldFlight),
							newValue: this.getDepartureTime(newFlight)
						});
					}

					// æ£€æŸ¥ç­æœŸå˜æ›´
					if (oldFlight.ç­æœŸ !== newFlight.ç­æœŸ) {
						changes.push({
							field: 'ç­æœŸ',
							label: 'ç­æœŸ',
							oldValue: oldFlight.ç­æœŸ,
							newValue: newFlight.ç­æœŸ
						});
					}

					// æ£€æŸ¥äº§å“åˆ†ç±»å˜æ›´
					const oldCategory = this.getProductCategory(oldFlight);
					const newCategory = this.getProductCategory(newFlight);
					if (oldCategory !== newCategory) {
						changes.push({
							field: 'äº§å“åˆ†ç±»',
							label: 'äº§å“åˆ†ç±»',
							oldValue: oldCategory,
							newValue: newCategory
						});
					}

					return changes;
				},

				groupModifiedFlightsByCity(modifiedFlights) {
					const grouped = {};
					modifiedFlights.forEach(flightPair => {
						const city = this.getDepartureAirport(flightPair.old);
						if (!grouped[city]) {
							grouped[city] = [];
						}
						grouped[city].push(flightPair);
					});

					// æŒ‰åŸå¸‚åç§°æ’åº
					const sortedGrouped = {};
					Object.keys(grouped).sort().forEach(city => {
						sortedGrouped[city] = grouped[city];
					});

					return sortedGrouped;
				}
			}
		}
	</script>
</body>

</html>
